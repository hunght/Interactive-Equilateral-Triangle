<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Equilateral Triangle with Correct Height Line</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
      }
      .triangle-container {
        width: 300px;
        height: 260px;
        position: relative;
        cursor: none;
        border: 1px solid #ccc;
        overflow: hidden;
      }
      .triangle {
        width: 100%;
        height: 100%;
        background-color: yellow;
      }
      #dot {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: red;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
      }
      #coordinates {
        margin-top: 20px;
        padding: 10px;
        background-color: white;
        border: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <div class="triangle-container" id="triangle-container">
      <svg class="triangle" viewBox="0 0 1 0.866" id="triangle-svg">
        <polygon
          points="0,0.866 0.5,0 1,0.866"
          fill="#e0e0e0"
          stroke="#333"
          stroke-width="0.005"
        />
        <text x="0.5" y="0.05" font-size="0.05" text-anchor="middle">1,0</text>
        <text x="0.05" y="0.85" font-size="0.05" text-anchor="start">0,0</text>
        <text x="0.95" y="0.85" font-size="0.05" text-anchor="end">0,1</text>
        <line
          id="bottom-height-line"
          x1="0"
          y1="0"
          x2="0"
          y2="0"
          stroke="blue"
          stroke-width="0.005"
          stroke-dasharray="0.01"
        />
        <text
          id="bottom-height-label"
          x="0"
          y="0"
          font-size="0.04"
          text-anchor="start"
          fill="blue"
        ></text>
        <line
          id="height-b"
          x1="0"
          y1="0"
          x2="0"
          y2="0"
          stroke="red"
          stroke-width="0.005"
          stroke-dasharray="0.01"
        />
        <text
          id="height-b-label"
          x="0"
          y="0"
          font-size="0.04"
          text-anchor="start"
          fill="red"
        ></text>
      </svg>
      <div id="dot"></div>
    </div>
    <div id="coordinates">0.33, 0.33, 0.33</div>

    <script src="triangleUtils.js"></script>
    <script>
      const container = document.getElementById('triangle-container');
      const dot = document.getElementById('dot');
      const coordinatesDisplay = document.getElementById('coordinates');
      const bottomHeightLine = document.getElementById('bottom-height-line');
      const bottomHeightLabel = document.getElementById('bottom-height-label');
      const heightB = document.getElementById('height-b');
      const heightBLabel = document.getElementById('height-b-label');

      function updateHeightLines(x, y) {
        console.log('Updating height lines:', x, y);

        // Update bottom height line
        bottomHeightLine.setAttribute('x1', x);
        bottomHeightLine.setAttribute('y1', TRIANGLE_HEIGHT - y);
        bottomHeightLine.setAttribute('x2', x);
        bottomHeightLine.setAttribute('y2', TRIANGLE_HEIGHT);

        // Calculate the height of the bottom line
        const bottomHeight = y;

        // Update the bottom height label position and text
        bottomHeightLabel.setAttribute('x', x + 0.01);
        bottomHeightLabel.setAttribute('y', TRIANGLE_HEIGHT - 0.02);
        bottomHeightLabel.textContent = bottomHeight.toFixed(2);

        // Height to side B (right side)
        const {
          intersectBx,
          intersectBy,
          length: heightBLength,
        } = calculateHeightB(x, y);
        heightB.setAttribute('x1', x);
        heightB.setAttribute('y1', TRIANGLE_HEIGHT - y);
        heightB.setAttribute('x2', intersectBx);
        heightB.setAttribute('y2', intersectBy);

        // Update height B label
        heightBLabel.setAttribute('x', (x + intersectBx) / 2 + 0.01);
        heightBLabel.setAttribute('y', (y + intersectBy) / 2);
        heightBLabel.textContent = heightBLength.toFixed(2);

        console.log('Bottom height line:', bottomHeightLine.outerHTML);

        console.log('Height B line:', heightB.outerHTML);
      }

      function updateDotAndCoordinates(x, y) {
        console.log('Input coordinates:', x, y);
        [x, y] = constrainToTriangle(x, y);
        console.log('Constrained coordinates:', x, y);

        const containerRect = container.getBoundingClientRect();
        console.log(
          'Container dimensions:',
          containerRect.width,
          containerRect.height
        );

        // Calculate the actual triangle height
        const trianglePixelHeight = (containerRect.width * Math.sqrt(3)) / 2;

        // Calculate dot position based on triangle geometry
        const dotX = x * containerRect.width;
        const dotY =
          containerRect.height - (y / TRIANGLE_HEIGHT) * trianglePixelHeight;

        console.log('Dot position:', dotX, dotY);

        dot.style.left = `${dotX}px`;
        dot.style.top = `${dotY}px`;
        updateHeightLines(x, y);

        coordinatesDisplay.textContent = `x: ${x.toFixed(2)}, y: ${y.toFixed(
          2
        )}`;
      }

      container.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        let x = (e.clientX - rect.left) / rect.width;
        let y = 1 - (e.clientY - rect.top) / rect.height;
        console.log('Mouse event coordinates:', x, y);

        updateDotAndCoordinates(x, y);
      });

      // Test case

      updateDotAndCoordinates(0.5, TRIANGLE_HEIGHT);
    </script>
  </body>
</html>
